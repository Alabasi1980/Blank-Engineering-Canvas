# الغوص في الأعماق: محرك المعالجة الذكي (The Metric Engine)

يعتبر "المحرك" هو العقل المدبر الذي يحول البيانات الخام الصامتة إلى "معلومات استراتيجية". لا يقوم المحرك بمجرد الجمع والطرح، بل يدير عملية **"تطهير منطقي"** للبيانات.

## 1. خوارزمية المعالجة المتسلسلة (Linear Pipeline)
عند دخول أي سطر بيانات، يمر بالمراحل التالية:

### أ. مرحلة الكشف الهرمي (Hierarchical Discovery)
بدلاً من البحث عن تطابق بسيط، يستخدم المحرك خوارزمية **Recursive Descendant Check**. 
- إذا كانت القاعدة تستهدف "إجمالي مشاريع المنطقة الغربية"، فإن المحرك يبني "خريطة أبناء" (Adjacency Map) لحظية، ويتحقق مما إذا كان المشروع المرتبط بالحركة هو ابن أو حفيد لهذا الأصل. هذا يسمح ببناء تقارير تجميعية ضخمة بضغطة زر.

### ب. معايرة الاتجاه (Directional Normalization)
هذه هي الطبقة المحاسبية الذكية. المحرك يمتلك "وعياً بالاتجاه المالي". يقوم بضرب القيمة في معامل متغير بناءً على "بُعد القائد":
- **المشتريات:** معامل (-1).
- **المبيعات:** معامل (+1).
- **المرتجعات:** تقوم بعكس المعامل تلقائياً.
هذه العملية تتم **قبل** تمرير القيمة للمعادلات، مما يضمن أن نواتج المعادلات (مثل الربحية) تكون سليمة رياضياً.

### ج. المعالجة التشعبية (Cascading Logic)
الميزة التي تنفرد بها منصتنا. في الأنظمة التقليدية، الحركة تؤثر في مكان واحد. في محركنا:
- يمكن للحركة أن "تتدفق" عبر القواعد. إذا فعلت خيار `Continue Processing` (الرمز التشعبي)، ستدخل الحركة في القاعدة الأولى (مثلاً: حساب الضريبة) ثم تستمر للقاعدة الثانية (مثلاً: حساب التكلفة الكلية). هذا يسمح ببناء **نماذج مالية متعددة الأبعاد** لنفس البيانات.

## 2. أنواع الأرصدة (Balance Intelligence)
المحرك لا يكتفي بحساب "ماذا حدث الآن"، بل يدير ثلاثة أبعاد زمنية:
1. **Period Balance:** التركيز على الأداء اللحظي.
2. **Opening Balance:** محرك البحث عن الماضي (Look-back Engine)؛ يقوم بجمع كافة الحركات التاريخية التي تسبق تاريخ البداية المختار، ليعطيك نقطة انطلاق دقيقة.
3. **Cumulative Total:** الجمع اللحظي التراكمي (Running Total) منذ أول يوم في تاريخ المؤسسة وحتى لحظة التقرير.

## 3. الأداء والسرعة (High-Performance Computing)
المحرك مبني بتقنية **Map-Reduce In-Memory**. بدلاً من طلب البيانات من الخادم في كل مرة، يقوم المحرك بـ "فهرسة" (Indexing) البيانات محلياً، مما يسمح بمعالجة آلاف الأسطر في أجزاء من الثانية، وهو ما يظهر جلياً في "المحاكي اللحظي" (Simulator).
